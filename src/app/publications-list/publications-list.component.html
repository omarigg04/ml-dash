<!-- Page Header -->
<div class="page-header">
  <h1 class="page-title">Mis Publicaciones</h1>
  <p class="page-description">Gestiona tus productos publicados en MercadoLibre</p>
</div>

<!-- Table Card -->
<div class="card table-card">
  <div class="table-header">
    <div>
      <h3 class="table-title">Lista de Publicaciones</h3>
      <p class="table-subtitle">{{ dataSource.length }} publicaciones encontradas</p>
    </div>
  </div>

  <div class="table-container">
    <mat-spinner *ngIf="isLoading" diameter="50" class="table-spinner"></mat-spinner>

    <table *ngIf="!isLoading" mat-table [dataSource]="dataSource" class="publications-table">

      <!-- Thumbnail Column -->
      <ng-container matColumnDef="thumbnail">
        <th mat-header-cell *matHeaderCellDef>Imagen</th>
        <td mat-cell *matCellDef="let item">
          <img
            [src]="item.thumbnail || 'assets/no-image.png'"
            alt="Thumbnail"
            class="thumbnail-image"
            (error)="$any($event.target).src='assets/no-image.png'"
          />
        </td>
      </ng-container>

      <!-- Title Column -->
      <ng-container matColumnDef="title">
        <th mat-header-cell *matHeaderCellDef>Título</th>
        <td mat-cell *matCellDef="let item" class="title-cell">
          <div class="title-content">
            <span class="title-text">{{ item.title }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Price Column -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Precio</th>
        <td mat-cell *matCellDef="let item">
          <span class="price-value">${{ item.price | number:'1.2-2' }}</span>
          <span class="price-currency">MXN</span>
        </td>
      </ng-container>

      <!-- Stock Column -->
      <ng-container matColumnDef="stock">
        <th mat-header-cell *matHeaderCellDef>Stock</th>
        <td mat-cell *matCellDef="let item">
          <span class="stock-value">{{ item.available_quantity }}</span>
        </td>
      </ng-container>

      <!-- Status Column -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef>Estado</th>
        <td mat-cell *matCellDef="let item">
          <span
            class="status-badge"
            [ngClass]="'status-' + item.status"
          >
            {{ getStatusLabel(item.status) }}
          </span>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let item">
          <div class="action-buttons">
            <button
              mat-button
              class="btn-action btn-duplicate"
              (click)="onDuplicate(item)"
              matTooltip="Duplicar publicación">
              <mat-icon>content_copy</mat-icon>
              <span class="btn-label">Duplicar</span>
            </button>

            <button
              mat-button
              class="btn-action btn-relist"
              (click)="onRelist(item)"
              [disabled]="item.status !== 'closed'"
              matTooltip="Republicar item cerrado">
              <mat-icon>refresh</mat-icon>
              <span class="btn-label">Republicar</span>
            </button>

            <button
              mat-icon-button
              class="btn-icon-action"
              (click)="onViewDetails(item)"
              matTooltip="Ver detalles">
              <mat-icon>visibility</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
    </table>

    <div *ngIf="!isLoading && dataSource.length === 0" class="no-data">
      <mat-icon class="no-data-icon">inventory_2</mat-icon>
      <p class="no-data-text">No hay publicaciones para mostrar</p>
      <p class="no-data-hint">Crea tu primera publicación para comenzar</p>
    </div>
  </div>
</div>
