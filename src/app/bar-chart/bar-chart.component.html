<!-- Page Header -->
<div class="page-header">
  <h1 class="page-title">Dashboard de Ventas</h1>
  <p class="page-description">Resumen de ingresos y estadísticas</p>
</div>

<!-- Stats Cards Grid -->
<div class="grid grid-cols-4 stats-grid">
  <!-- Total Sum Card -->
  <div class="card stat-card">
    <div class="stat-header">
      <div class="stat-icon-container" style="background-color: hsl(var(--chart-1) / 0.1);">
        <mat-icon class="stat-icon" style="color: hsl(var(--chart-1));">attach_money</mat-icon>
      </div>
    </div>
    <div class="stat-body">
      <p class="stat-label">Ventas Totales</p>
      <mat-spinner *ngIf="totalSumIsLoading" diameter="24" class="stat-spinner"></mat-spinner>
      <h2 *ngIf="!totalSumIsLoading" class="stat-value">{{ totalSum | currency:'MXN':'symbol':'1.0-0' }}</h2>
      <p class="stat-change" *ngIf="!totalSumIsLoading" [class.positive]="totalSumChangePercent > 0"
        [class.negative]="totalSumChangePercent < 0" [class.neutral]="totalSumChangePercent === 0">
        <mat-icon class="change-icon">{{ totalSumChangeIcon }}</mat-icon>
        <span>{{ totalSumChangePercent > 0 ? '+' : '' }}{{ totalSumChangePercent | number:'1.1-1' }}% vs período
          anterior</span>
      </p>
    </div>
  </div>

  <!-- Shipping Card -->
  <div class="card stat-card">
    <div class="stat-header">
      <div class="stat-icon-container" style="background-color: hsl(var(--chart-2) / 0.1);">
        <mat-icon class="stat-icon" style="color: hsl(var(--chart-2));">local_shipping</mat-icon>
      </div>
    </div>
    <div class="stat-body">
      <p class="stat-label">Costos de Envío</p>
      <mat-spinner *ngIf="enviosIsLoading" diameter="24" class="stat-spinner"></mat-spinner>
      <h2 *ngIf="!enviosIsLoading" class="stat-value">{{ envios | currency:'MXN':'symbol':'1.0-0' }}</h2>
      <p class="stat-change neutral" *ngIf="!enviosIsLoading">
        <span class="text-muted">Total acumulado</span>
      </p>
    </div>
  </div>

  <!-- Fees Card -->
  <div class="card stat-card">
    <div class="stat-header">
      <div class="stat-icon-container" style="background-color: hsl(var(--chart-3) / 0.1);">
        <mat-icon class="stat-icon" style="color: hsl(var(--chart-3));">receipt</mat-icon>
      </div>
    </div>
    <div class="stat-body">
      <p class="stat-label">Comisiones ML</p>
      <mat-spinner *ngIf="feesIsLoading" diameter="24" class="stat-spinner"></mat-spinner>
      <h2 *ngIf="!feesIsLoading" class="stat-value">{{ fees | currency:'MXN':'symbol':'1.0-0' }}</h2>
      <p class="stat-change neutral" *ngIf="!feesIsLoading">
        <span class="text-muted">Total en comisiones</span>
      </p>
    </div>
  </div>

  <!-- Real Sum Card -->
  <div class="card stat-card stat-card-highlight">
    <div class="stat-header">
      <div class="stat-icon-container" style="background-color: hsl(var(--success) / 0.1);">
        <mat-icon class="stat-icon" style="color: hsl(var(--success));">account_balance_wallet</mat-icon>
      </div>
    </div>
    <div class="stat-body">
      <p class="stat-label">Ganancia Real</p>
      <mat-spinner *ngIf="realSumIsLoading" diameter="24" class="stat-spinner"></mat-spinner>
      <h2 *ngIf="!realSumIsLoading" class="stat-value text-success">{{ realSum | currency:'MXN':'symbol':'1.0-0' }}</h2>
      <p class="stat-change" *ngIf="!realSumIsLoading" [class.positive]="realSumChangePercent > 0"
        [class.negative]="realSumChangePercent < 0" [class.neutral]="realSumChangePercent === 0">
        <mat-icon class="change-icon">{{ realSumChangeIcon }}</mat-icon>
        <span>{{ realSumChangePercent > 0 ? '+' : '' }}{{ realSumChangePercent | number:'1.1-1' }}% vs período
          anterior</span>
      </p>
    </div>
  </div>
</div>

<!-- Chart Card -->
<div class="card chart-card">
  <div class="chart-header">
    <div>
      <h3 class="chart-title">Comparación de Rendimiento</h3>
      <p class="chart-subtitle">Ventas diarias - Comparación de períodos</p>
    </div>
    <div class="chart-controls">
      <!-- Dropdown de comparación -->
      <mat-form-field appearance="outline" class="comparison-selector">
        <mat-label>Comparación</mat-label>
        <mat-select [(value)]="selectedPeriod" (selectionChange)="onPeriodChange($event.value)">
          <mat-option value="2weeks">2 Semanas</mat-option>
          <mat-option value="2months">2 Meses</mat-option>
          <mat-option value="2bimesters">2 Bimestres</mat-option>
        </mat-select>
      </mat-form-field>

      <!-- Datepicker personalizado (modo rango único) -->
      <div class="custom-date-picker">
        <mat-form-field appearance="outline" class="compact-date-field">
          <mat-label>Rango personalizado</mat-label>
          <mat-date-range-input [formGroup]="customRangeForm" [rangePicker]="picker" [max]="maxDate">
            <input matStartDate formControlName="start" placeholder="Inicio">
            <input matEndDate formControlName="end" placeholder="Fin">
          </mat-date-range-input>
          <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-date-range-picker #picker panelClass="custom-datepicker-panel"></mat-date-range-picker>
        </mat-form-field>
        <button mat-raised-button color="primary" (click)="applyCustomRange()"
          [disabled]="!customRangeForm.value.start || !customRangeForm.value.end" class="apply-custom-btn">
          Aplicar
        </button>
      </div>

      <!-- Checkbox para órdenes no cumplidas -->
      <div class="unfulfilled-checkbox">
        <mat-checkbox [(ngModel)]="showUnfulfilled" (change)="onUnfulfilledToggle()" color="primary">
          Canceled
        </mat-checkbox>
      </div>
    </div>
  </div>

  <div class="chart-container">
    <mat-spinner *ngIf="isLoading" diameter="50" class="chart-spinner"></mat-spinner>
    <ag-charts-angular *ngIf="!isLoading" style="height: 400px; width: 100%;" [options]="options">
    </ag-charts-angular>
  </div>
</div>